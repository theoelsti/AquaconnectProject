var colors=[];let tempJson=[];let dateTagJson=[];let phJson=[];let lumJson=[];let medianTemp=[];let medianPh=[];let medianLum=[];let medianTime=[];function readTextFile(file,callback){var rawFile=new XMLHttpRequest();rawFile.overrideMimeType("application/json");rawFile.open("GET",file,true);rawFile.onreadystatechange=function(){if(rawFile.readyState===4&&rawFile.status=="200"){callback(rawFile.responseText)}};rawFile.send(null)}function setPhColors(){for(var i=0;i<phJson.length;i+=1){if(phJson[i]<6.8||phJson[i]>7.5){if(phJson[i]<6.4||phJson[i]>7.9){colors[i]='#da3c43dd'}else{colors[i]='#fc8a3edd'}}else{colors[i]='#008a3edd'}}}function drawChart(){var ctx=document.getElementById('myChart').getContext('2d');var myChart=new Chart(ctx,{type:'line',data:{labels:dateTagJson,datasets:[{label:'Température de l\'eau en °C',data:tempJson,backgroundColor:'#3cb6d5',borderColor:'#0c252b',borderWidth:0.2,borderDash:[5,5]},{type:'bar',label:'PH de l\'eau',data:phJson,borderColor:'rgba(255, 99, 132, 1)',backgroundColor:colors}]},options:{scales:{y:{beginAtZero:true},x:{ticks:{autoSkip:true,maxTicksLimit:10}}},elements:{point:{radius:3}},plugins:{title:{display:true,text:'Ph et Température en fonction du temps'},decimation:{enabled:false,algorithm:'lttb'}}}});var ctx=document.getElementById('lumChart').getContext('2d');var lumChart=new Chart(ctx,{type:'line',data:{labels:dateTagJson,datasets:[{label:'Luminosité de l\'aquarium',data:lumJson,backgroundColor:'#3cb6d5',borderColor:'#0c252b',borderWidth:0.7,borderDash:[5,5]}]},options:{scales:{y:{beginAtZero:false},x:{ticks:{autoSkip:true,maxTicksLimit:10}}},elements:{point:{radius:2}},plugins:{title:{display:true,text:'Evolution de la luminosité de l\'aquarium en fonction du temps'}}}})}function changeToDate(){const hwid=new URLSearchParams(window.location.search).get('id');if(selected==undefined){new ToasterBox({msg:'Merci de selectionner des dates',html:true,time:5000,className:null,closeButton:false,maxWidth:180,autoOpen:true,position:'top-right',backgroundColor:"#c93237",closeIcon:null})}else{document.location.href="values.php?id="+hwid+"&dates="+selected[0]+"&datee="+selected[1]}}readTextFile("./results.json",function(text){var data=JSON.parse(text);data.forEach(element=>{dateTagJson.push(element['datetag']);tempJson.push(element['temp']);phJson.push(element['ph']);lumJson.push(element['lum'])});dateTagJson=dateTagJson.reverse();tempJson=tempJson.reverse();phJson=phJson.reverse();lumJson=lumJson.reverse();if(dateTagJson.length>120){let tempTemp=[];let tempPh=[];let tempLum=[];i=0;let dateSet=false;let refDate=null;dateTagJson.forEach(date=>{if(!dateSet){refDate=date.substring(0,13);medianTime.push(refDate+':00');dateSet=true}if(date.substring(0,13)!=refDate){dateSet=false;if(tempPh!==[]){medianPh.push(moyenne(tempPh))}medianTemp.push(moyenne1(tempTemp));medianLum.push(moyenne2(tempLum));tempTemp=[];tempPh=[];tempLum=[]}else{tempLum.push(lumJson[i]);tempTemp.push(tempJson[i]);tempPh.push(phJson[i])}i+=1});tempJson=medianTemp;phJson=medianPh;lumJson=medianLum;dateTagJson=medianTime}setPhColors();drawChart()});function moyenne(array){let sum=0;for(let i=0;i<array.length;i+=1){sum+=parseFloat(array[i])}return((sum/array.length).toFixed(1))}function moyenne1(array){let sum1=0;for(let i=0;i<array.length;i+=1){sum1+=parseFloat(array[i])}return((sum1/array.length).toFixed(1))}function moyenne2(array){let sum2=0;for(let i=0;i<array.length;i+=1){sum2+=parseFloat(array[i])}return((sum2/array.length).toFixed(1))}readTextFile("./lastResults.json",function(text){var data=JSON.parse(text);document.getElementsByClassName('phValue')[0].innerHTML=data[0].ph;document.getElementsByClassName('tempValue')[0].innerHTML=data[0].temp+'°C';document.getElementsByClassName('lumValue')[0].innerHTML=data[0].lum;document.getElementsByClassName('dateLast')[0].innerHTML=data[0].datetag.split(' ')[0];document.getElementsByClassName('heureLast')[0].innerHTML=data[0].datetag.split(' ')[1]});